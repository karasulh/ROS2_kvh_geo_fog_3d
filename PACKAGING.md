# Packaging

To package this repository, follow these steps.

## Summary

ONLY FOLLOW THESE STEPS IF YOU ALREADY KNOW WHAT THE REST OF THIS FILE SAYS!!!

```
catkin_generate_changelog
(edit CHANGELOG.rst)
(save, add, commit, and push CHANGELOG.rst)
catkin_prepare_release --bump {major,minor,patch}
git push --tags
bloom-generate rosdebian --os-name ubuntu --os-version <version here> --ros-distro <ROS distro here>
fakeroot debian/rules binary
```
## Step 0: Figure out your new version

NOTE: If you are unfamiliar with software versioning practice for this project, consult the software wiki here: https://confluence.mitre.org/display/MET2MIP/Versioning

You need your software version in your CHANGELOG.rst and your package.xml to match. The catkin tools do not do this automatically.

Thus, you must select how you intend to update your version. Are you updating patch, minor, or major? Look at package.xml, figure out what the current version is,
and select your next version accordingly (it should be an increment of one of the numbers).

Then, use this in the catkin changelog generation step.

## Changelog

Run the following commands:

1a) If first release

```catkin_generate_changelog --all```

1b) If subsequent releases or CHANGELOG.rst exists

```catkin_generate_changelog```

2) Edit and fix up CHANGELOG.rst

This should be done in an editor. You need to manually put in your release number and date, in
ISO 8601 format (YYYY-MM-DD).

An example of a good changelog is here: https://github.com/ros-infrastructure/ros_buildfarm/blob/master/CHANGELOG.rst

Here's a sample line:

```
2.0.1 (2018-04-30)
------------------

* Improvements

  * use egrep to find repository components in arbitrary positions (`#532 <https://github.com/ros-infrastructure/ros_buildfarm/pull/532>`_)

* Fixes

  * revert "remove using the test_depend from binary jobs" introduced in 2.0.0 (`#540 <https://github.com/ros-infrastructure/ros_buildfarm/pull/540>`_)
  * add missing import from future for Python 2 compatibility (`#537 <https://github.com/ros-infrastructure/ros_buildfarm/pull/537>`_)
```

3) Add, commit, and push your CHANGELOG.rst

## Release

To perform your release, you must do two things:

* Prepare your release using catkin's tools. This increments versions, tags your repository
* Use python-bloom to generate your debian packaging files

### Catkin preparation

Run the following command, selecting either major, minor, or patch.

"major" bumps the first number.
"minor" bumps the second number.
"patch" bumps the third number.

```
catkin_prepare_release --bump {major,minor,patch}
```

IMPORTANT: Your version that you bump **TO** must match the version you set in your CHANGELOG.rst in step 1!

### Bloom for Debian files

Run the following python-bloom command to get your debian/ directory set up, based on package.xml.

```
bloom-generate rosdebian --os-name ubuntu --os-version <version here> --ros-distro <ROS distro here>
```

Example:
```
bloom-generate rosdebian --os-name ubuntu --os-version xenial --ros-distro kinetic
```

## Packaging

To create your debian package using the files generated by bloom, run the following command.

```
fakeroot debian/rules binary
```

This will create a debian package in the directory above your current directory.
